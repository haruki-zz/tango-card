# 记忆日语单词桌面应用设计文档

## 1. 产品目标与范围
- 目标：提供跨平台（macOS/Windows/Linux）的日语单词记忆工具，借助 AI 补全读音与语境，支持卡片式复习与活跃度追踪。
- 风格：极简平面化，避免拟物；强调层次与对比，卡片与背景留足空白。
- 暂不覆盖：账号体系、云同步、离线语音合成。

## 2. 平台与技术选型
- 桌面壳：Electron（禁止使用 Tauri）；前端建议 React + Vite，样式用 Tailwind 或精简样式模块。
- 状态管理：React Query（请求/缓存）+ 本地状态；或轻量 Zustand。
- 本地存储：SQLite（better-sqlite3/Drizzle/Prisma 其一）置于用户数据目录；设定与 UI 状态存 JSON。
- AI 接口：可插拔 LLM API（OpenAI/自建推理服务）；输出读音、情境化释义与例句。

## 3. 核心功能需求
- 新增单词
  - 用户输入单词与可选备注；AI 返回罗马音、情境化释义（1 条主释义，2-3 条补充语境）与 1-2 条例句（日/英并列）。
  - 允许手动编辑 AI 结果并保存。
  - 错误处理：AI 失败可稍后重试，保留草稿。
- 单词卡片
  - 正面：单词 + 读音（罗马音）；背面：单词、读音、释义（分点）、例句（原文+翻译）。
  - 点击翻转（水平翻转动效 <250ms）；键盘快捷键支持翻面与切换下一张。
  - 风格：扁平卡片，柔和阴影或边框分隔，中性背景；字体优先系统日文字体。
- 复习队列
  - 从库中随机抽取 30 张卡片组成本次队列；支持重新抽取。
  - 队列内支持上/下一张、标记掌握/未掌握；记录当次结果以供统计。
- Heat Map
  - 仿 GitHub 贡献度格子，展示每日新增/复习活跃度（按天聚合，支持最近 12 周）。
  - 点击格子查看该日新增数与复习完成数。

## 4. 信息结构与数据模型
- Word
  - `id` (UUID) / `term` / `reading` (罗马音) / `meanings` (富文本或结构化列表) / `examples` (原文、翻译) / `note` / `created_at`
- ReviewSession
  - `id` / `word_ids` (30) / `started_at` / `completed_at` / `result`（掌握/未掌握标记）
- Activity
  - 每日统计：`date` / `words_added` / `reviews_completed`

## 5. 关键界面与交互
- 主视图：左侧导航（新增、复习、统计），右侧主区域。
- 新增单词表单：输入框 + AI 生成按钮；生成中显示 Spinner；结果区可编辑。
- 卡片复习：居中卡片；上下/左右切换；翻转动效；底部显示进度 `n/30`。
- Heat Map：矩阵格子 + 简短图例；悬浮提示每日数据；点击弹出该日详情。
- 预留深浅色主题接口，首版默认亮色。

## 6. 架构与模块
- App 壳（Electron 主进程）：窗口管理、应用菜单、文件系统与本地 DB 访问（经 IPC 暴露安全方法）。
- Renderer（React）：界面、状态管理、卡片渲染与交互。
- IPC API：`word:add`, `word:listRandom`, `review:create`, `activity:stats` 等；白名单通信，避免任意文件访问。
- AI 服务封装：独立模块处理 prompt 拼装、重试、超时与解析；可切换后端。

## 7. AI 生成策略（最小可行）
- Prompt 输出 JSON：`reading`, `meanings`（分点、附情境）、`examples`（原文+英译或中译）。
- 控制长度：释义 2-4 条，例句 1-2 条；避免过长。
- 失败重试：最多 2 次，超时回落到“待补全”状态。
- 用户可覆盖生成内容并保存为最终版本。

## 8. 性能、可靠性与边界
- 首屏 <1s：预加载本地 DB 连接，延迟加载 AI 模块。
- 离线行为：新增单词时若无网，提示“保存草稿并稍后补全”；复习与 Heat Map 基于本地数据可离线使用。
- 数据备份：提供导出/导入 JSON/CSV 接口（后续迭代）。
- 无障碍：键盘可完成所有核心操作；卡片翻转与按钮具备可见焦点。

## 9. 验收标准（首版）
- 三大桌面平台可启动、创建/保存单词、生成并展示卡片两面、完成 30 张队列复习。
- Heat Map 正确反映每日新增与复习完成数并支持悬浮提示。
- AI 生成失败时不阻塞保存与复习流程。

## 10. 后续迭代建议
- 间隔重复算法（如 SM2）取代纯随机队列。
- TTS 发音播放；手写输入与假名转换。
- 云端备份/多端同步；多语言 UI。
