# 日语单词记忆 APP 设计文档

## 目标与定位
- 面向日语学习者，快速录入生词并借助 AI 生成读音/释义/例句，形成可翻转的记忆卡片。
- 鼓励日更与复习，Heat Map 量化活跃度，熟悉度标签简化记忆阶段管理。

## 用户故事
- 作为学习者，我输入或粘贴一个日语单词，系统自动补全读音、解释和例句，保存为卡片。
- 作为学习者，我在复习区浏览卡片，先看正面（单词+读音），翻面查看解释和例句，并标记熟/不熟。
- 作为学习者，我通过 Heat Map 看到自己每日添加/复习的活跃程度，维持学习连续性。
- 作为学习者，我打开首页就能看到优先推荐的未熟单词卡片，并能快速进入新增、复习或查看完整 Heat Map。

## 功能清单
- 核心
  - 添加单词：手动输入词面；调用 AI 生成读音（假名）、中文释义和日文例句；用户可编辑后保存。
  - 卡片视图：正面显示单词与读音；背面显示单词、读音、解释、例句；支持翻转。
  - 复习流程：顺序或随机播放卡片；翻面后可标记 `familiar` / `unfamiliar`；支持跳过与重置。
  - 主页聚合：首页主卡片随机抽取词库（优先 unfamiliar 且复习次数最高，次数相同随机，其次 familiar；词库为空提示），并提供新增单词按钮、复习入口、当月 Heat Map 预览及当月新增/复习计数，点击 Heat Map 跳转完整页面。
- 辅助
  - Heat Map：展示每日“学习事件”数量（新增单词 + 完成复习一次），支持周/月切换。
  - 记忆等级：每个单词持有 familiar/unfamiliar 状态，复习标记实时更新；显示上次复习时间与累计次数。
- 系统/其他
  - 简易搜索与筛选（按熟悉度、创建时间）。
  - 账号与同步（可选）：本地优先，后续支持登录后云同步。

## 信息架构与数据模型
- 实体
  - `User`：id，profile，设置（例：默认复习批次大小）。
  - `WordEntry`：id，surface（词面），reading（假名），meaningZh，exampleJa，familiarity(enum: familiar|unfamiliar)，createdAt，updatedAt，lastReviewedAt，reviewCount，aiMeta(model, promptHash)。
  - `ReviewEvent`：id，wordId，result(enum: familiar|unfamiliar)，timestamp。
  - `ActivityLog`：date，addCount，reviewCount（驱动 Heat Map）。
- 关系与规则
  - 保存/复习事件均写入 `ActivityLog`。
  - 复习标记 familiar 切换 `familiarity` 字段，并累计 `reviewCount` 与 `lastReviewedAt`。

## 核心流程
- 添加单词
  1) 用户输入词面 → 2) 调用 AI 生成 reading/meaning/example → 3) 允许用户编辑 → 4) 保存 `WordEntry` + `ReviewEvent(add)` → 更新 Heat Map。
- 复习
  1) 选定复习列表（全部/未熟/自定义筛选）→ 2) 显示卡片正面 → 3) 用户尝试回忆 → 4) 翻面 → 5) 标记 familiar/unfamiliar → 6) 更新 `WordEntry`、写入 `ReviewEvent`、更新 Heat Map。
- Heat Map
  - 每日事件 = 新增单词数 + 完成复习的卡片数；支持按周/月聚合，月视图按自然月（1 号到当月底）范围；首页摘要区汇总同月新增/复习计数并提供预览点击跳转。
- 首页展示与导航
  1) 启动时加载本地数据库，未就绪显示加载/错误提示 → 2) 按优先规则抽取词库展示主卡片（词库为空显示提示卡）→ 3) 下方展示当月 Heat Map 预览与新增/复习计数 → 4) 提供新增单词、复习会话、完整 Heat Map 的导航入口。

## 界面草图（文字）
- 导航：`词库`（列表+搜索） / `复习`（卡片翻转流） / `热力图`（统计） / `设置`；首页包含直达新增/复习/热力图的按钮。
- 卡片：正面大号词面 + 假名；背面补充释义、例句；标记按钮 `熟悉` / `不熟`；支持左右滑动换卡。
- Heat Map：按日方格显示强度，点击某日展示具体新增/复习数。
- 新增页：单词输入框 + “AI 生成”按钮 + 生成结果可编辑区。
- 首页：顶部主卡片（空库提示或抽取词条），卡片下方放置当月 Heat Map 预览与当月新增/复习计数，底部有“新增单词”“开始复习”“查看热力图”入口。

## AI 生成策略
- Prompt 需求：给出“词面”，返回假名读音、简洁中文释义（不超过 30 字）、1 条自然的日文例句，保持 JSON 结构便于解析。
- 防错：若 AI 失败或超时，允许手动输入；生成后用户可编辑。
- 质量：避免未成年人不宜内容；对非常见词提示用户确认。

## 记忆等级规则
- 初始默认 `unfamiliar`。
- 标记 `familiar`：更新字段并记录 `ReviewEvent`；可增加简单的“连续熟悉次数”用于后续算法扩展。
- 标记 `unfamiliar`：重置连续熟悉次数；可在复习队列中提前出现（简单权重：不熟词优先）。

## 指标与反馈
- 核心指标：日新增词数、日复习完成数、7 日留存（连续打卡天数）、熟悉率（familiar / 总复习）。
- 体验指标：AI 生成成功率、单词保存成功率、平均加载时长。

## 技术与实现要点（建议）
- 客户端：移动优先；卡片动画用原生或轻量动画库；本地缓存（IndexedDB / SQLite）。
- 后端：提供鉴权、单词 CRUD、AI 生成接口代理、活动日志存储；可用 Serverless 快速实现。
- AI 接入：服务端代理 OpenAI/等模型；做去重和速率限制。
- 同步策略：离线可用，本地队列恢复后上报 `ReviewEvent` 与 `ActivityLog`。
- 首页状态：本地数据库加载/错误提示必备，数据为空时主卡片显示友好提示，Heat Map 预览使用当月数据。

## 边界与后续迭代
- 未来可加入：分级复习算法（SRS）、多例句、多标签、听力模式（只播读音）、分享/导出。
- 隐私：用户数据默认私有；明示 AI 调用并提示敏感词规避。
