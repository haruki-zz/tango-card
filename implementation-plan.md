# 实施计划

1. 初始化开发环境
   - 步骤：确认 Node 版本满足 Electron/Vite 要求，执行依赖安装，配置 `.env.local` 占位键值（空值即可）避免后续读取报错。
   - 结果：项目可在本地安装依赖并具备基础环境变量文件。
   - 验证：运行 `npm install` 不报错；执行 `npm run lint` 目前仅检查配置是否就绪。

2. 搭建 Electron + React/Vite 骨架
   - 步骤：创建 `src/main` 与 `src/renderer` 基础入口，配置 electron-vite 或等效脚手架、`electron-builder` 打包目标。
   - 结果：可启动空白窗口的跨平台桌面应用，主/渲染进程热更新可用。
   - 验证：执行 `npm run dev` 启动后看到空白窗口且控制台无报错；执行 `npm run build` 生成产物目录。

3. 配置 Tailwind、ESLint、Prettier
   - 步骤：在 renderer 中集成 Tailwind，添加基础浅色/绿色变量，接入 ESLint + Prettier 配置与 scripts。
   - 结果：前端可使用原子化样式，统一代码风格检查。
   - 验证：运行 `npm run lint` 确认无格式错误；启动 `npm run dev` 查看全局样式是否生效（可在空页面放置占位文本确认）。

4. 定义共享类型与 SM-2 计算
   - 步骤：在 `src/shared` 定义词条、复习日志、活跃度数据类型与 JSON 校验逻辑，编写 SM-2 更新与队列排序纯函数。
   - 结果：拥有可复用的纯函数与类型，供主/渲染进程调用。
   - 验证：编写 Vitest 单测覆盖 SM-2 更新公式、队列排序与 JSON 校验的正常与边界输入，运行 `npm test -- shared`。

5. 主进程存储层（文件读写）
   - 步骤：在 `src/main` 实现对 `words.jsonl`、`reviews.jsonl`、`activity.json` 的读写，采用临时文件写入再替换；封装新增词条、记录复习日志、聚合活跃度的函数。
   - 结果：可靠的本地数据存储，支持 append 与聚合读取。
   - 验证：使用 Vitest + 临时目录单测验证写入后文件内容与 JSON 校验一致，模拟磁盘写失败时保证原文件未损坏。

6. 主进程 AI 提供商适配层
   - 步骤：抽象统一接口封装 OpenAI 与 Google 调用，加入超时与长度限制，提供 mock 实现供无网络测试；不返回或记录完整密钥。
   - 结果：可通过统一方法生成词条内容，并具备可替换的 provider 结构。
   - 验证：单测用 mock fetch 验证超时/错误分支；在 dev 模式下以 mock provider 生成固定响应，确保前端流程可走通。

7. IPC 合同与安全桥接
   - 步骤：定义类型安全的 IPC 信道，暴露新增词条（含 AI 生成）、加载词库、拉取复习队列、提交评分、读取/写入活跃度、导入/导出、设置 provider 与密钥等接口；通过 `contextBridge` 限定可调用列表。
   - 结果：渲染进程只能调用受控接口，返回值已过校验。
   - 验证：编写主进程集成单测，使用 electron-mock 或直接调用 handler 验证各接口的入参校验与返回格式；确保未知信道无法调用。

8. 渲染进程状态管理（Zustand）
   - 步骤：建立全局 store，包含词库列表、当前复习队列、session 状态、活跃度数据、AI provider 配置；封装调用 IPC 的异步 actions。
   - 结果：前端组件可通过 store 获取数据与触发异步操作，状态与主进程数据同步。
   - 验证：编写 store 单测，mock IPC 层验证 actions 对状态的更新与错误处理路径。

9. 新增词条流程（最小可用版本）
   - 步骤：实现表单输入单词、触发 AI 生成预览、允许用户编辑结果后保存；保存成功刷新词库与活跃度。
   - 结果：用户可新增词条并看到持久化效果。
   - 验证：编写 React Testing Library 测试，mock IPC 返回，验证表单校验、加载/错误提示、保存后列表刷新；手动运行 `npm run dev` 新增词条并检查 `words.jsonl` 写入。

10. 复习队列与 SM-2 更新
    - 步骤：渲染端加载待复习队列，卡片正反面切换，评分后调用 IPC 更新词条与复习日志；进入复习时创建 session，退出时记录 session 次数。
    - 结果：用户可按照 SM-2 流程复习并更新下一次时间，活跃度 session 计数增加。
    - 验证：组件测试覆盖翻转与评分按钮行为，断言调用的 IPC 参数；单测验证 SM-2 更新后 `next_review_at` 合法；手动复习一次后检查 `reviews.jsonl` 与 `activity.json`。

11. 活跃度方格视图
    - 步骤：实现按日展示新增词数与 session 数的绿色深浅方格，hover 展示详情。
    - 结果：用户可视化每日活跃度。
    - 验证：组件测试使用固定数据渲染颜色深浅与 tooltip 文案；手动新增/复习后查看 UI 变化。

12. 导入/导出与数据校验
    - 步骤：实现导入 JSON/JSONL、导出 JSON/CSV，导入时进行 schema 校验与去重；提供前端入口与进度提示。
    - 结果：用户可安全迁移数据，损坏文件被拒绝。
    - 验证：单测覆盖合法/非法文件、重复 ID 的处理；手动导入/导出小样本文件并在磁盘检查内容。

13. 设置页（LLM 提供商与密钥）
    - 步骤：提供 provider 下拉与密钥输入，主进程使用系统安全存储保存密钥，不回显完整值；增加测试用 mock provider 选项。
    - 结果：用户可切换模型并安全存储密钥，默认不泄露。
    - 验证：组件测试验证表单校验与 IPC 调用；手动切换 provider、重启应用后检查设置持久化。

14. 打包与发布烟测
    - 步骤：配置 `electron-builder` 目标（macOS dmg/zip、Windows nsis/portable），校验静态资源与环境变量注入；生成安装包做最小功能回归。
    - 结果：可分发的安装包，基础功能正常。
    - 验证：运行 `npm run build` 与 `npm run pack`，在本地安装包内完成新增词条、复习、活跃度查看的手动测试。

15. 回归测试与文档补充
    - 步骤：整理新增测试覆盖率报告，补充 README/用户指引，若有架构调整同步更新设计文档与架构说明。
    - 结果：测试覆盖核心路径，文档同步，团队可交接。
    - 验证：执行 `npm test -- --coverage` 达到预期阈值；人工审阅文档与设计文件更新完备。
